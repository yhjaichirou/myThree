
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head  th:replace="template::cmsHeader(客服服务中心)"></head>

<style>
/* .layui-logo ,.layui-nav-tree .layui-nav-item{
background: linear-gradient(to right,#f00,#ff0);
font-weight: bold;
} */
</style>
<body class="layui-layout-body">
  
  <div id="LAY_app">
    <div class="layui-layout layui-layout-admin">
      <div class="layui-header">
        <!-- 头部区域 -->
        <ul class="layui-nav layui-layout-left">
          <li class="layui-nav-item layadmin-flexible" lay-unselect>
            <a href="javascript:;" layadmin-event="flexible" title="侧边伸缩">
              <i class="layui-icon layui-icon-shrink-right" id="LAY_app_flexible"></i>
            </a>
          </li>
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="http://www.layui.com/admin/" target="_blank" title="前台">
              <i class="layui-icon layui-icon-website"></i>
            </a>
          </li>
          <li class="layui-nav-item" lay-unselect>
            <a href="javascript:;" layadmin-event="refresh" title="刷新">
              <i class="layui-icon layui-icon-refresh-3"></i>
            </a>
          </li>
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <input type="text" placeholder="搜索..." autocomplete="off" class="layui-input layui-input-search" layadmin-event="serach" lay-action="template/search.html?keywords="> 
          </li>
          
        </ul>
        <ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">
          
          <li class="layui-nav-item" lay-unselect>
            <a lay-href="app/message/index.html" layadmin-event="message" lay-text="消息中心">
              <i class="layui-icon layui-icon-notice"></i>  
              
              <!-- 如果有新消息，则显示小圆点 -->
              <span class="layui-badge-dot"></span>
            </a>
          </li>
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="javascript:;" layadmin-event="theme">
              <i class="layui-icon layui-icon-theme"></i>
            </a>
          </li>
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="javascript:;" layadmin-event="note">
              <i class="layui-icon layui-icon-note"></i>
            </a>
          </li>
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="javascript:;" layadmin-event="fullscreen">
              <i class="layui-icon layui-icon-screen-full"></i>
            </a>
          </li>
          <li class="layui-nav-item" lay-unselect>
            <a href="javascript:;">
              <cite>[[${session.loginUser.remarkName}]]</cite>
            </a>
            <dl class="layui-nav-child">
              <!-- <dd><a lay-href="/dzb/first/info" href="javascript:;">基本资料</a></dd> -->
              <dd><a href="#" id="updataPwd">修改密码</a></dd>
              <hr>
              <dd  style="text-align: center;" ><a href="#" id="logout">退出</a></dd>
            </dl>
          </li>
          
          <li class="layui-nav-item layui-hide-xs" lay-unselect>
            <a href="javascript:;" layadmin-event="about"><i class="layui-icon layui-icon-more-vertical"></i></a>
          </li>
          <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-unselect>
            <a href="javascript:;" layadmin-event="more"><i class="layui-icon layui-icon-more-vertical"></i></a>
          </li>
        </ul>
      </div>
      
      <!-- 侧栏菜单 -->
      <div class="layui-side layui-side-menu">
        <div class="layui-side-scroll">
          <div class="layui-logo" lay-href="home/home.html">
          	<img alt="" th:src="@{/image/cat.png}" style="width: 40px;position: absolute;height: 40px;left: 15px;top: 3px;" >
            <span>客服服务中心</span>
          </div>
          
          <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu" lay-filter="layadmin-system-side-menu" >
          		
	  			<!-- <li data-name="home" class="layui-nav-item layui-nav-itemed">
	              <a href="javascript:;" lay-tips="主页" lay-direction="2">
	                <i class="layui-icon layui-icon-home"></i>
	                <cite>主页</cite>
	              </a>
	              <dl class="layui-nav-child">
	                <dd data-name="console" class="layui-this">
	                  <a lay-href="home/console.html">控制台</a>
	                </dd>
	                <dd data-name="console">
	                  <a lay-href="home/homepage1.html">主页一</a>
	                </dd>
	                <dd data-name="console">
	                  <a lay-href="home/homepage2.html">主页二</a>
	                </dd>
	              </dl>
	            </li> -->
          </ul>
        </div>
      </div>
      
        <!-- 页面标签 -->
      <div class="layadmin-pagetabs" id="LAY_app_tabs">
        <div class="layui-icon layadmin-tabs-control layui-icon-prev back" layadmin-event="leftPage"></div>
        <div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
        <div class="layui-icon layadmin-tabs-control layui-icon-down">
          <ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
            <li class="layui-nav-item" lay-unselect>
              <a href="javascript:;"></a>
              <dl class="layui-nav-child layui-anim-fadein">
                <dd layadmin-event="closeThisTabs"><a href="javascript:;">关闭当前标签页</a></dd>
                <dd layadmin-event="closeOtherTabs"><a href="javascript:;">关闭其它标签页</a></dd>
                <dd layadmin-event="closeAllTabs"><a href="javascript:;">关闭全部标签页</a></dd>
              </dl>
            </li>
          </ul>
        </div>
        <div class="layui-tab" lay-unauto lay-allowClose="true" lay-filter="layadmin-layout-tabs">
          <ul class="layui-tab-title" id="LAY_app_tabsheader">
            <li lay-id="/home.html" lay-attr="/home.html" class="layui-this"><i class="layui-icon layui-icon-home"></i></li>
          </ul>
        </div>
      </div>
      
      <!-- 主体内容 -->
      <div class="layui-body" id="LAY_app_body">
        <div class="layadmin-tabsbody-item layui-show">
        <iframe src="home" frameborder="0" class="layadmin-iframe"></iframe>
        </div>
      </div>
      
      <!--  辅助元素，一般用于移动设备下遮罩  -->
      <div class="layadmin-body-shade" layadmin-event="shade"></div>
      	<div id="imgScale" class="hide layui-layer-wrap" style="width: 670px;display:none; height: 320px;position:relative; ">
			 <img src="//cdn.layui.com/upload/2019_11/168_1573492741201_28207.jpg"
			  style="max-width: 100%;max-height: 100%;width:auto;height:auto;position: absolute;left: 50%;top: 50%;transform: translate3d(-50%,-50%,0);-webkit-transform: translate3d(-50%,-50%,0);">
		</div>
    
    </div>
  </div>
  
  <!-- 模板js -->
   <div th:replace="template::commonJs"></div>
   <script th:inline="javascript" type="text/javascript">
	 navList = [[${#request.getAttribute('navList')}]];
	 console.log(navList)
	</script>
  <script th:inline="javascript" type="text/javascript">
	
	  	//全屏弹框
		var layerAllScreen = function layerAllScreen(url){
			var imgScale = window.document.getElementById("imgScale");
			imgScale.style.display='block';
			var iWidth = document.documentElement.clientWidth; 
			var iHeight = document.documentElement.clientHeight; 
			$(imgScale).find("img").attr("src",url);
			$(imgScale).css({"width":iWidth*2/3,"height":iHeight*2/3});
			layer.open({
				 type: 1,
				  title: false,
				  closeBtn: 0,
				  area: ['auto'],
				  skin: 'layui-layer-nobg', //没有背景色
				  shadeClose: true,
				  content: $("#imgScale"),
				  end :function(){
					  imgScale.style.display='none';
				  }
			});
		}
	  
	  if (window!=top){ // 判断当前的window对象是否是top对象
			top.location.href =window.location.href; // 如果不是，将top对象的网址自动导向被嵌入网页的网址
		}
	  
	  layui.config({
		    base: contextPath+"/layuiadmin/" 
	  }).extend({
		    index: 'lib/index' 
	  }).use(['index','layer','slide'],function(){
	  	var slide = layui.slide;
	  	var $ = layui.jquery;
	  	
	  	slide(navList);

		// 退出登录
		$("#logout").on("click", function() {
			layer.confirm('确定退出吗？', {icon: 3, title:'退出'}, function(index){
				$.ajax({
					url : contextPath + "/admin/logout",
					dataType : 'json',
					type : 'post',
					success:function(rt){
                    	window.location.href= contextPath + "/admin/login";
					}
				})
			});

		});
		
		//基本信息
		$('#info').on("click",function(){
			$('#LAY_app_body').append(
				`<div class="layadmin-tabsbody-item layui-show">
				          <iframe th:replace="@{${contextPath}/index/info}" frameborder="0" class="layadmin-iframe"></iframe>
				        </div>`
					
			)
			window.location.href= contextPath + "/admin/login";
		})
		
		// 更换密码
		$("#updataPwd").on("click", function() {
			resetPwd();
		});
		function resetPwd() {
			var context = '<form class="layui-form" action="" style="padding: 30px 30px 10px 0px;">'
					+ '<div class="layui-form-item">'
					+ '<label class="layui-form-label">旧密码：</label>'
					+ '<div class="layui-input-block">'
					+ '<input type="password" name="title" id="oldP" required  lay-verify="required" placeholder=请输入旧密码" autocomplete="off" class="layui-input pwd">'
					+ '</div>'
					+ '</div>'
					+ '<div class="layui-form-item">'
					+ '<label class="layui-form-label">新密码：</label>'
					+ '<div class="layui-input-block">'
					+ '<input type="password" name="title" id="newP" required  lay-verify="required" placeholder="请输入新密码" autocomplete="off" class="layui-input pwd">'
					+ '</div>'
					+ '</div>'
					+ '<div class="layui-form-item">'
					+ '<label class="layui-form-label">重新输入：</label>'
					+ '<div class="layui-input-block">'
					+ '<input type="password" name="title" id="reP" required  lay-verify="required" placeholder="请重新输入新密码" autocomplete="off" class="layui-input pwd">'
					+ '</div>' + '</div>'
					+ '<span class="layui-input-block" id="msg" hidden="hidden"></span>'
					// +'<div><button>ȷ��</button><button>ȡ��</button></div>'
					+ '</form>';

			var lay = layer.open({
			  	  type: 1 // Page层类型
			  	  ,area: ["50%", "70%"]
			  	  ,title: "修改密码"
			  	  ,shade: 0.6 // 遮罩透明度
			  	  ,maxmin: true // 允许全屏最小化
			  	  ,anim: 0 // 0-6的动画形式，-1不开启
			  	  ,content: context
				  ,btn : [ '确定', '取消' ]
			  	  ,offset: "auto"
			  	  ,success:function(dom){
			  		$(".layui-layer-btn .layui-layer-btn-").css("padding-right","50px");
					$(".pwd").blur(function(){
						if ($("#oldP").val().length > 16
								|| $("#oldP").val().length < 6) {
							$("#msg").html("请输入6-16位");
							$("#msg").show();
						} else if ($("#newP").val().length > 16
								|| $("#newP").val().length < 6) {
							$("#msg").html("请输入6-16位");
							$("#msg").show();
						} else if ($("#reP").val().length > 16
								|| $("#reP").val().length < 6) {
							$("#msg").html("请输入6-16位");
							$("#msg").show();
						} else if ($("#reP").val() != $("#newP").val()) {
							$("#msg").html("两次输入的密码不相同");
							$("#msg").show();
						} else{
							$("#msg").hide();
						}
					})
			  	  }
			  	  ,yes : function(index, layero) {
						if($("#msg").is(':hidden')){
							var con = {};
							con.oldP = $("#oldP").val();
							con.newP = $("#newP").val();
							$.ajax({
								url : contextPath + "/admin/updataPwd",
								dataType : 'json',
								type : 'post',
								data : {
									params : JSON.stringify(con)
								},
								success:function(rt){
									console.log(rt);
									if (rt.code != 200) {
										layer.msg(rt.msg);
									}else{
										layer.msg("修改成功");
									
										setTimeout(function(){ layer.close(index);window.location.href=contextPath+"/admin/"+loginUrl; }, 1500);
										
									}
								}
							})
						}else{
							$("#msg").html("有问题无法提交");
						}
					}
				});
		}
		
	  
	  
  });
  </script>
  


</body>
</html>


